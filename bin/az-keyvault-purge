#!/bin/bash

source ./lib.sh
warning "This will purge ALL soft deleted KeyVaults"

list=$(az keyvault list-deleted --query "[].name" -o tsv)

[[ $list == "" ]] && { echo "No deleted KeyVaults found! Bye..."; exit 1; }

while IFS= read -r name; do
  echo " - Purging KeyVault $name"
  az keyvault purge -n "$name" --no-wait
done <<< "$list"
